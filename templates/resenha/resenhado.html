{% extends 'base.html' %}
{% block content %}
<!-- ##### Main Area Start ##### -->
<main class="container">
    <section class="poster_more_details">
        <div>
            <p class="resenha_titles">Resenha escrita em: {{ date }}</p>
            <p class="resenha_titles">Autor: {{ user_author.name }} {{ user_author.surname }}</p>
            <!-- ## like/deslike buttons ## -->
            <table class="like">
                <tr>
                    <td>
                        {% if session.id == data.author_id %}
                        <img src="{{ url_for('static', filename='img/core-img/like_unclick.png') }}"
                            alt="Você não pode curtir a sua própria resenha">
                        {% else %}
                        {% if PNG == 'unclick' %}
                        <a href="{{ url_for('cur.curtida', resenha_id=data.id) }}">
                            <img src="{{ url_for('static', filename='img/core-img/like_click.png') }}" alt=""></a>
                        {% else %}
                        <a href="{{ url_for('cur.curtida', resenha_id=data.id) }}">
                            <img src="{{ url_for('static', filename='img/core-img/like_unclick.png') }}" alt=""></a>
                        {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if like == 0 %} Nenhuma curtida ainda {% else %}{{ like }}{% endif %}
                    </td>
                </tr>
                <tr>
                    <td></td>
                </tr>
            </table>
            <div class="poster_image">
                {% if spotify.image == None %}
                <img src="/static/img/bg-img/No-Image-Available.png" alt="">
                {% else %}
                <img src="{{ spotify.image }}" alt="">
                {% endif %}
            </div>
            <!-- ##### Table Resenha Start ##### -->
            <table class="table_poster">
                <tr>
                    <td colspan="2" class="resenha_titles">{{ data.nome_review }}</td>
                </tr>

                <!-- # Defining name by the type of review # -->
                {% if data.tipo_review == 'album' or data.tipo_review == 'track' %}
                <tr>
                    <td class="resenha_titles">Artista:</td>
                    <td class="resenha_item">{{ spotify.artistName }}</td>
                </tr>
                <tr>
                    <td class="resenha_titles">Album:</td>
                    {% if data.tipo_review == 'track' %}
                    <td class="resenha_item">{{ spotify.albumName }}</td>
                    {% else %}
                    <td class="resenha_item">{{ spotify.name }}</td>
                    {% endif %}
                </tr>
                {% elif data.tipo_review == 'playlist' %}
                <tr>
                    <td class="resenha_titles">Nome:</td>
                    <td class="resenha_item">{{ spotify.name }}</td>
                </tr>
                {% else %}
                <tr>
                    <td class="resenha_titles">Banda / Artista:</td>
                    <td class="resenha_item">{{ spotify.name }}</td>
                </tr>
                {% endif %}
                {% if data.tipo_review == 'track' %}
                <tr>
                    <td class="resenha_titles">Música:</td>
                    <td class="resenha_item">{{ spotify.name }}</td>
                </tr>
                {% endif %}
                {% if data.tipo_review == 'album' or data.tipo_review == 'track' %}
                <tr>
                    <td class="resenha_titles">Release:</td>
                    <td class="resenha_item">{{ spotify.releaseDate }}</td>
                </tr>
                {% endif %}
                <tr>
                    <td class="resenha_titles">Sobre:</td>
                    {% if data.tipo_review == 'album' %}
                    <td class="resenha_item">um ALBUM completo</td>
                    {% elif data.tipo_review == 'artista' %}
                    <td class="resenha_item">Um ARTISTA ou BANDA</td>
                    {% elif data.tipo_review == 'track' %}
                    <td class="resenha_item">Uma MÚSICA</td>
                    {% else %}
                    <td class="resenha_item">Uma PLAYLIST</td>
                    {% endif %}
                </tr>
                <tr>
                    <td class="resenha_titles">Resenha:</td>
                    {% autoescape false %}
                    <td class="resenha_item">{{ data.review|replace('\n', "<br>") }}</td>
                    {% endautoescape %}
                </tr>
                <tr>
                    <td colspan="2" class="resenha_spotify"><iframe src="{{ spotify.radio }}" width="300" height="300"
                            frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe></td>
                </tr>
                <tr>
                    {% if session.id == user_author.id %}
                    <td class="resenha_titles"></td>
                    <td class="resenha_item"><a href="{{ url_for('res.resenhaEdit', id=data.id) }}">
                            <button type="submit" class="btn btn-primary btn-salvar" value="data.id">Editar</button></a>
                        <button type="button" class="btn btn-danger"
                            onclick="window.history.go(-1); return false;">Voltar</button>
                    </td>
                </tr>
                {% endif %}
                <tr>
                    {% if spotify.genres|length > 0 %}
                    <td class="resenha_titles">Gêneros:</td>
                    <td class="resenha_item">
                        {% for item in spotify.genres %}
                        {{ item }} |
                        {% endfor %}
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td colspan="2">
                        <!-- FB share button code -->
                       <i class="fab fa-facebook"></i><a target="_blank"
                         href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.resenhando.co%2Fresenhado%2F{{ data.id }}%2F&amp;src=sdkpreparse"
                         class="fb-xfbml-parse-ignore"><span class="socialMediaResenhado"> Facebook</span></a>
                        &nbsp;<b>|</b>&nbsp;

                        <!-- WhatsApp Share Button -->
                        <i class="fab fa-whatsapp"> </i><a href="whatsapp://send?text=http://www.resenhando.co/resenhado/{{ data.id }}/"
                            data-action="share/whatsapp/share"><span class="socialMediaResenhado"> Whatsapp</span></a>&nbsp;<b>|</b>&nbsp;

                        <!-- Copy to clipboard -->
                        <input type="hidden" value="http://www.resenhando.co/resenhado/{{ data.id }}/" id="myInput">

                        <div class="custom-tooltip">
                            <span class="glyphicon glyphicon-link"></span>
                            <a href="javascript:void(0);" id="btnCopyLink">
                                <span class="custom-tooltiptext" id="myTooltip">
                                    Copiar link</span>
                                <i class="fas fa-link"></i><span class="socialMediaResenhado"> Copiar Link</span>
                            </a>
                        </div>

                    </td>
                </tr>
            </table>
            <!-- ##### Table Resenha End ##### -->
        </div>

    </section>



</main>
<!-- ##### Main Area End ##### -->
<section class="comments">
    <section class="container">
        {% if not session.id %}
        <p class="comments_text">Faça <a href="{{ url_for('log.login') }}">login</a> para postar um comentário</p>
        {% else %}
        <form action="{{ url_for('com.comentario') }}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="id" value="{{ data.id }}">
            <div class="comments_writing">
                <textarea id="comentario" name="comentario" class="form-control" rows="2" cols="3"
                    placeholder="Comente essa resenha:" required></textarea>
                <button type="submit" class="btn btn-link">Postar</button>
            </div>
            <br>
        </form>
        {% endif %}
    </section>
    <section class="container comments_result">
        {% for comment in comments|sort(attribute='id', reverse=true) %}
        {% for user in comment_user %}
        {% if comment.user_id == user.id %}
        {{ user.name }} {{ user.surname }}
        {% endif %}
        {% endfor %} em {{ comment.comment_date.strftime('%d/%m/%Y') }}:<br>
        <table class="comments_review">
            <tr>
                <td>{{ comment.review }}</td>
                {% if comment.user_id == session.id %}
                <td class="buttons">
                    <a data-url="{{ url_for('com.CommentDelete', comment_id=comment.id, resenha_id=data.id) }}"
                        class="delete">
                        <button type="submit" class="btn btn-link">deletar</button></a></td>
                {% endif %}
            </tr>
        </table>
        <br>
        {% endfor %}
    </section>
</section>
{% endblock %}